---
title: 构建自定义模块
---

Quill 作为编辑器的核心优势在于其丰富的 API 和强大的自定义功能。当你在 Quill 的 API 之上实现功能时,将其组织为模块可能会很方便。为了本指南的目的,我们将演示构建字数统计模块的一种方法,这是许多文字处理器中常见的功能。

<Hint>
在内部,模块是 Quill 大部分功能的组织方式。你可以通过实现自己的模块并使用相同的名称注册来覆盖这些默认[模块](/docs/modules/)。
</Hint>

### 统计字数

字数统计器的核心只是计算编辑器中的字数并在某个 UI 中显示此值。因此我们需要:

1. 监听 Quill 中的文本更改。
1. 计算字数。
1. 显示此值。

让我们直接进入一个完整的示例!

<Sandpack
  defaultShowPreview
  externalResources={[
    "{{site.cdn}}/quill.snow.css",
    "{{site.cdn}}/quill.js",
  ]}
  files={{
    'index.html': `
<link href="/index.css" rel="stylesheet">

<div id="editor"></div>
<div id="counter">0</div>

<script src="/index.js"></script>
    `,
    'index.css': `
#editor {
  border: 1px solid #ccc;
}

#counter {
  border: 1px solid #ccc;
  border-width: 0px 1px 1px 1px;
  color: #aaa;
  padding: 5px 15px;
  text-align: right;
}
    `,
    'index.js': `
function Counter(quill, options) {
  const container = document.querySelector('#counter');
  quill.on(Quill.events.TEXT_CHANGE, () => {
    const text = quill.getText();
    // 这种方式统计字数有几个问题
    // 但我们稍后会修复这些问题
    container.innerText = text.split(/\\s+/).length;
  });
}

Quill.register('modules/counter', Counter);

// 我们现在可以像这样初始化 Quill:
const quill = new Quill('#editor', {
  modules: {
    counter: true
  }
});
    `
  }}
/>

这就是向 Quill 添加自定义模块所需的全部内容!函数可以[注册](/docs/api/#quillregistermodule/)为模块,它将与任何选项一起传递相应的 Quill 编辑器对象。

### 使用选项

模块会传递一个选项对象,可用于微调所需的行为。我们可以使用它来接受计数器容器的选择器,而不是硬编码的字符串。让我们还自定义计数器以计算字数或字符数:

<Sandpack
  defaultShowPreview
  externalResources={[
    "{{site.cdn}}/quill.snow.css",
    "{{site.cdn}}/quill.js",
  ]}
  files={{
    'index.html': `
<link href="/index.css" rel="stylesheet">

<div id="editor"></div>
<div id="counter">0</div>

<script src="/index.js"></script>
    `,
    'index.css': `
#editor {
  border: 1px solid #ccc;
}

#counter {
  border: 1px solid #ccc;
  border-width: 0px 1px 1px 1px;
  color: #aaa;
  padding: 5px 15px;
  text-align: right;
}
    `,
    'index.js': `
function Counter(quill, options) {
  const container = document.querySelector(options.container);
  quill.on(Quill.events.TEXT_CHANGE, () => {
    const text = quill.getText();
    if (options.unit === 'word') {
      container.innerText = text.split(/\\s+/).length + ' words';
    } else {
      container.innerText = text.length + ' characters';
    }

  });
}

Quill.register('modules/counter', Counter);

// 我们现在可以像这样初始化 Quill:
const quill = new Quill('#editor', {
  modules: {
    counter: {
      container: '#counter',
      unit: 'word'
    }
  }
});
    `
  }}
/>

### 构造函数

由于任何函数都可以注册为 Quill 模块,我们可以将计数器实现为 ES5 构造函数或 ES6 类。这允许我们直接访问和使用模块。

<Sandpack
  defaultShowPreview
  externalResources={[
    "{{site.cdn}}/quill.snow.css",
    "{{site.cdn}}/quill.js",
  ]}
  files={{
    'index.html': `
<link href="/index.css" rel="stylesheet">

<div id="editor"></div>
<div id="counter">0</div>

<script src="/index.js"></script>
    `,
    'index.css': `
#editor {
  border: 1px solid #ccc;
}

#counter {
  border: 1px solid #ccc;
  border-width: 0px 1px 1px 1px;
  color: #aaa;
  padding: 5px 15px;
  text-align: right;
}
    `,
    'index.js': `
class Counter {
  constructor(quill, options) {
    const container = document.querySelector(options.container);
    quill.on(Quill.events.TEXT_CHANGE, () => {
      const text = quill.getText();
      if (options.unit === 'word') {
        container.innerText = text.split(/\\s+/).length + ' words';
      } else {
        container.innerText = text.length + ' characters';
      }

    });
  }

  calculate() {
    const text = this.quill.getText();

    return this.options.unit === 'word' ?
      text.split(/\\s+/).length :
      text.length;
  }
}

Quill.register('modules/counter', Counter);

// 我们现在可以像这样初始化 Quill:
const quill = new Quill('#editor', {
  modules: {
    counter: {
      container: '#counter',
      unit: 'word'
    }
  }
});
    `
  }}
/>

### 总结

现在让我们用 ES6 完善模块并修复一些烦人的错误。就是这样!

<Sandpack
  defaultShowPreview
  externalResources={[
    "{{site.cdn}}/quill.snow.css",
    "{{site.cdn}}/quill.js",
  ]}
  files={{
    'index.html': `
<link href="/index.css" rel="stylesheet">

<div id="editor"></div>
<div id="counter">0</div>

<script src="/index.js"></script>
    `,
    'index.css': `
#editor {
  border: 1px solid #ccc;
}

#counter {
  border: 1px solid #ccc;
  border-width: 0px 1px 1px 1px;
  color: #aaa;
  padding: 5px 15px;
  text-align: right;
}
    `,
    'index.js': `
class Counter {
  constructor(quill, options) {
    this.quill = quill;
    this.options = options;
    this.container = document.querySelector(options.container);
    quill.on(Quill.events.TEXT_CHANGE, this.update.bind(this));
  }

  calculate() {
    const text = this.quill.getText();

    if (this.options.unit === 'word') {
      const trimmed = text.trim();
      // 分割空文本会返回非空数组
      return trimmed.length > 0 ? trimmed.split(/\\s+/).length : 0;
    } else {
      return text.length;
    }
  }

  update() {
    const length = this.calculate();
    let label = this.options.unit;
    if (length !== 1) {
      label += 's';
    }
    this.container.innerText = \`\${length} \${label}\`;
  }
}

Quill.register('modules/counter', Counter);

// 我们现在可以像这样初始化 Quill:
const quill = new Quill('#editor', {
  modules: {
    counter: {
      container: '#counter',
      unit: 'word'
    }
  }
});
    `
  }}
/>